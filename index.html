<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>For Taylor ‚ù§Ô∏è</title>

  <style>
    :root{
      --pink:#ff4d6d;
      --deep:#d6336c;
      --bg1:#fff6fa;
      --bg2:#ffe0ea;
      --card:#ffffff;
      --ink:#2b2b2b;
      --muted:#6b6b6b;
      --shadow: 0 12px 28px rgba(0,0,0,0.10);
      --shadow2: 0 18px 55px rgba(0,0,0,0.18);
      --line: rgba(0,0,0,0.08);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Georgia, "Times New Roman", serif;
      background: radial-gradient(circle at top, var(--bg1) 0%, #ffeef2 45%, var(--bg2) 100%);
      color:var(--ink);
      text-align:center;
      padding: 24px 14px 90px;
      overflow-x:hidden;
    }
    h1{
      margin: 12px 0 6px;
      color:var(--deep);
      font-size: 2.05rem;
      letter-spacing: 0.2px;
    }
    .sub{
      margin:0 0 16px;
      opacity:0.92;
      font-size: 1.02rem;
    }
    .card{
      background: var(--card);
      padding: 18px 16px;
      border-radius: 16px;
      box-shadow: var(--shadow);
      max-width: 590px;
      margin: 14px auto;
      text-align:left;
    }
    .center{ text-align:center; }
    .divider{
      height:1px;
      background: var(--line);
      margin: 14px 0;
    }
    .small{
      font-size: 0.92rem;
      color:var(--muted);
      margin-top: 6px;
      text-align:center;
      line-height:1.35;
    }
    .pillrow{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:center;
      margin-top: 10px;
    }
    .pill{
      padding:8px 10px;
      border-radius: 999px;
      background: #fff0f5;
      border: 1px solid rgba(214,51,108,0.18);
      font-size: 0.95rem;
    }
    button{
      background: var(--pink);
      border: none;
      color: white;
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 1.02rem;
      cursor: pointer;
      margin: 8px 6px;
      box-shadow: 0 10px 20px rgba(255,77,109,0.25);
      transition: transform .08s ease, filter .08s ease;
      -webkit-tap-highlight-color: transparent;
    }
    button:active{ transform: translateY(1px) scale(0.99); }
    button.secondary{
      background:#fff;
      color:var(--deep);
      border:1px solid rgba(214,51,108,0.22);
      box-shadow:none;
    }
    .hidden{ display:none; }

    /* Ambient hearts */
    .floatHeart{
      position: fixed;
      bottom: -24px;
      user-select:none;
      pointer-events:none;
      opacity: 0.8;
      animation: floatUp linear forwards;
      z-index: 1;
    }
    @keyframes floatUp{
      from { transform: translateY(0) scale(0.9); opacity:0.85; }
      to   { transform: translateY(-120vh) scale(1.35); opacity:0; }
    }

    /* Toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      max-width: 92vw;
      width: 560px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: var(--shadow2);
      border: 1px solid rgba(214,51,108,0.18);
      padding: 14px 14px;
      text-align:left;
      z-index: 9999;
      display:none;
    }
    .toastTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .toastTitle{
      font-weight:700;
      color:var(--deep);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .toastClose{
      background:transparent;
      border:none;
      color:#999;
      font-size: 18px;
      cursor:pointer;
      padding: 6px 10px;
      border-radius: 10px;
    }
    .toastBody{
      margin-top:8px;
      line-height:1.55;
      font-size: 1.02rem;
    }

    /* Gallery */
    .gallery{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    .thumb{
      position:relative;
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(0,0,0,0.08);
      box-shadow: 0 10px 18px rgba(0,0,0,0.08);
      cursor:pointer;
      background:#fff;
      aspect-ratio: 1 / 1;
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transform: scale(1.03);
      filter: blur(10px);
      transition: filter .25s ease;
    }
    .thumb.revealed img{ filter: blur(0); }
    .thumb::after{
      content:"tap";
      position:absolute;
      right:8px;
      bottom:8px;
      background: rgba(255,255,255,0.88);
      border: 1px solid rgba(214,51,108,0.18);
      color: var(--deep);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      font-size: 0.75rem;
      padding: 4px 8px;
      border-radius:999px;
    }

    /* Modal */
    .modal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 9998;
    }
    .polaroid{
      width: min(92vw, 540px);
      background:#fff;
      border-radius: 18px;
      box-shadow: var(--shadow2);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,0.15);
    }
    .polaroid img{
      width:100%;
      height:auto;
      display:block;
    }
    .polaroidBottom{
      padding: 12px 14px 16px;
    }
    .captionTitle{
      color:var(--deep);
      font-weight:700;
      margin: 0 0 6px;
      font-size: 1.05rem;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .captionText{
      margin:0;
      color:#444;
      opacity:0.95;
      line-height:1.45;
    }

    /* Love meter */
    input[type="range"]{
      width: 100%;
      margin: 12px 0 6px;
    }
    .meterRow{
      display:flex;
      justify-content:space-between;
      color:var(--muted);
      font-size:0.92rem;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    /* Timeline */
    .timelineBtns{ display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin-top:8px; }
    .timelineOut{ margin-top: 10px; line-height:1.6; color:#444; }

    /* Code unlock */
    textarea, input[type="text"]{
      width:100%;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.15);
      padding: 10px 12px;
      font-family: inherit;
      font-size: 1rem;
      outline:none;
    }

    /* Envelopes */
    .envGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-top:10px;
    }
    .env{
      border-radius: 14px;
      border: 1px solid rgba(214,51,108,0.18);
      background: #fff0f5;
      box-shadow: 0 10px 18px rgba(0,0,0,0.06);
      padding: 12px 10px;
      text-align:center;
      cursor:pointer;
      user-select:none;
    }
    .env .icon{ font-size: 22px; }
    .env .lbl{
      margin-top:6px;
      font-size:0.92rem;
      color:#444;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    /* Wheel */
    .wheelBox{
      position:relative;
      height: 220px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(255,255,255,0.82), rgba(255,240,245,0.9));
      border: 1px solid rgba(214,51,108,0.12);
      overflow:hidden;
      display:grid;
      place-items:center;
    }
    .wheel{
      width: 160px;
      height: 160px;
      border-radius: 50%;
      border: 10px solid rgba(214,51,108,0.12);
      background: conic-gradient(
        rgba(255,77,109,0.25) 0 60deg,
        rgba(214,51,108,0.20) 60deg 120deg,
        rgba(255,77,109,0.18) 120deg 180deg,
        rgba(214,51,108,0.16) 180deg 240deg,
        rgba(255,77,109,0.22) 240deg 300deg,
        rgba(214,51,108,0.18) 300deg 360deg
      );
      transition: transform 1.4s cubic-bezier(.15,.85,.12,1);
    }
    .pointer{
      position:absolute;
      top: 16px;
      width: 0; height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-bottom: 18px solid rgba(214,51,108,0.75);
    }
    .wheelNote{
      text-align:center;
      margin-top:10px;
      color:#444;
      opacity:.95;
      min-height: 24px;
    }

    /* Heartbeat hold */
    .holdBtn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      padding: 14px 16px;
      border-radius: 14px;
      background: #fff0f5;
      border: 1px solid rgba(214,51,108,0.22);
      cursor:pointer;
      user-select:none;
      box-shadow: 0 10px 18px rgba(0,0,0,0.06);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .beat{
      width: 12px; height: 12px;
      border-radius: 50%;
      background: var(--pink);
      transform: scale(1);
      transition: transform .12s ease;
      box-shadow: 0 0 0 rgba(255,77,109,0.0);
    }
    .beating .beat{
      animation: beat 0.55s infinite;
    }
    @keyframes beat{
      0% { transform: scale(1); box-shadow: 0 0 0 rgba(255,77,109,0.0); }
      50%{ transform: scale(1.55); box-shadow: 0 0 18px rgba(255,77,109,0.35); }
      100%{ transform: scale(1); box-shadow: 0 0 0 rgba(255,77,109,0.0); }
    }

    /* Maze */
    .mazeWrap{
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(255,255,255,0.82), rgba(255,240,245,0.92));
      border: 1px solid rgba(214,51,108,0.12);
      overflow:hidden;
      padding: 10px;
    }
    canvas{
      width: 100%;
      height: auto;
      display:block;
      border-radius: 12px;
      background: #fff;
      border: 1px solid rgba(0,0,0,0.08);
      touch-action: none; /* important for drag on iPhone */
    }

    /* Final surprise */
    .lockRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:10px;
      margin-top:10px;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--muted);
      font-size:0.92rem;
    }
  </style>
</head>

<body>
  <h1>Taylor ‚ù§Ô∏è</h1>
  <p class="sub">A little Valentine‚Äôs page ‚Äî made just for you.</p>

  <div class="card center">
    <div class="pillrow">
      <div class="pill">üß© maze secret</div>
      <div class="pill">üéµ our song</div>
      <div class="pill">üíå letters</div>
      <div class="pill">üì∏ memory</div>
      <div class="pill">‚ù§Ô∏è cute + romantic</div>
    </div>
    <p class="small">Save this link. It‚Äôs yours forever.</p>
  </div>

  <!-- 1) MAZE -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">1) The Love Maze üß©</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Drag the heart through the maze. When you reach the end, you‚Äôll unlock a secret message.
    </p>

    <div class="mazeWrap" style="margin-top:12px;">
      <canvas id="maze" width="360" height="360" aria-label="Love Maze"></canvas>
    </div>

    <div class="center">
      <button class="secondary" onclick="resetMaze()">Reset maze</button>
    </div>

    <div id="mazeWin" class="hidden" style="margin-top:10px; line-height:1.6; color:#444;">
      <div class="divider"></div>
      <strong style="color:var(--deep);">Maze complete üíò</strong>
      <p style="margin:8px 0 0;">
        (placeholder secret message ‚Äî you‚Äôll give me this later)
      </p>
    </div>
  </div>

  <!-- 2) SPOTIFY SONG -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">2) Play our song üéµ</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Add <em>‚ÄúSo Easy (To Fall in Love)‚Äù ‚Äî Olivia Dean</em> here. Tap play.
    </p>

    <div class="divider"></div>

    <!-- You will paste the Spotify track link below later -->
    <p style="margin:0 0 8px;color:var(--muted);font-size:.95rem;">
      Paste Spotify track link (from Share ‚Üí Copy link) here:
    </p>
    <input id="spotifyLink" type="text" placeholder="https://open.spotify.com/track/..." />

    <div class="center">
      <button onclick="setSpotify()">Set song</button>
      <button class="secondary" onclick="clearSpotify()">Clear</button>
    </div>

    <div id="spotifyPlayerWrap" class="hidden" style="margin-top:10px;">
      <iframe
        id="spotifyPlayer"
        style="border-radius:14px;border:1px solid rgba(0,0,0,0.08);width:100%;height:152px;"
        src=""
        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
        loading="lazy">
      </iframe>
      <p class="small">If it doesn‚Äôt play inline, tap ‚ÄúOpen in Spotify‚Äù on the player.</p>
    </div>
  </div>

  <!-- 3) TAP-TO-REVEAL MEMORY (blurred thumbs + modal) -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">3) Tap to reveal our memory üì∏</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      The night we first said ‚ÄúI love you.‚Äù Tap a photo to unblur it, then tap again to view it bigger.
    </p>

    <div class="divider"></div>

    <div class="gallery" id="gallery">
      <div class="thumb" data-i="0"><img src="IMG_5847.JPG" alt="Memory 1"></div>
      <div class="thumb" data-i="1"><img src="IMG_5848.JPG" alt="Memory 2"></div>
      <div class="thumb" data-i="2"><img src="IMG_5852.JPG" alt="Memory 3"></div>
    </div>

    <p class="small">(placeholder captions ‚Äî we can customize later)</p>
  </div>

  <!-- 4) LOVE METER -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">4) Love meter ‚ù§Ô∏è</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Slide it all the way. (There‚Äôs a surprise at the end.)
    </p>

    <div class="divider"></div>

    <input id="meter" type="range" min="0" max="110" value="0" />
    <div class="meterRow">
      <span>0</span><span>50</span><span>100</span><span>‚àû</span>
    </div>

    <div id="meterMsg" class="hidden" style="margin-top:10px; line-height:1.6; color:#444;">
      <div class="divider"></div>
      <strong style="color:var(--deep);">Unlocked üíó</strong>
      <p style="margin:8px 0 0;">(placeholder love-meter message)</p>
    </div>
  </div>

  <!-- 5) OUR STORY TIMELINE -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">5) Our story timeline üï∞Ô∏è</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Tap a moment to reveal it.
    </p>

    <div class="timelineBtns">
      <button class="secondary" onclick="timeline('met')">When we met</button>
      <button class="secondary" onclick="timeline('date')">First date</button>
      <button class="secondary" onclick="timeline('kiss')">First kiss</button>
      <button class="secondary" onclick="timeline('ily')">First ‚ÄúI love you‚Äù</button>
    </div>

    <div id="timelineOut" class="timelineOut">(placeholder ‚Äî we‚Äôll fill this in)</div>
  </div>

  <!-- 6) SECRET CODE UNLOCK -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">6) Secret code üîê</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Type the code and unlock a message. (We‚Äôll decide the code later.)
    </p>

    <div class="divider"></div>

    <input id="codeIn" type="text" placeholder="enter code‚Ä¶" />
    <div class="center">
      <button onclick="unlock()">Unlock</button>
      <button class="secondary" onclick="resetUnlock()">Reset</button>
    </div>

    <div id="codeOut" class="hidden" style="margin-top:10px; line-height:1.6; color:#444;">
      <div class="divider"></div>
      <strong style="color:var(--deep);">Unlocked üíå</strong>
      <p style="margin:8px 0 0;">(placeholder secret-code message)</p>
    </div>
  </div>

  <!-- 7) LOVE LETTER ENVELOPES -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">7) Love letters üíå</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Tap an envelope to open a letter. (Placeholders for now.)
    </p>

    <div class="envGrid">
      <div class="env" onclick="openLetter(1)"><div class="icon">üíå</div><div class="lbl">Letter 1</div></div>
      <div class="env" onclick="openLetter(2)"><div class="icon">üíå</div><div class="lbl">Letter 2</div></div>
      <div class="env" onclick="openLetter(3)"><div class="icon">üíå</div><div class="lbl">Letter 3</div></div>
    </div>

    <div id="letterOut" class="hidden" style="margin-top:10px; line-height:1.65; color:#444;">
      <div class="divider"></div>
      <strong id="letterTitle" style="color:var(--deep);">Letter</strong>
      <p id="letterBody" style="margin:8px 0 0;">(placeholder letter text)</p>
    </div>
  </div>

  <!-- 8) REASONS GENERATOR -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">8) Reasons I love you üíñ</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Tap for a reason. (We‚Äôll load your real reasons later.)
    </p>

    <div class="center">
      <button onclick="nextReason()">Give me one</button>
    </div>

    <div id="reasonOut" style="margin-top:10px; line-height:1.65; color:#444; text-align:center;">
      (placeholder reason)
    </div>
  </div>

  <!-- 9) SPIN WHEEL -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">9) Spin the wheel üé°</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Tap spin. It lands on something cute. (We‚Äôll customize the options later.)
    </p>

    <div class="divider"></div>

    <div class="wheelBox">
      <div class="pointer"></div>
      <div class="wheel" id="wheel"></div>
    </div>

    <div class="center">
      <button onclick="spin()">Spin</button>
    </div>

    <div class="wheelNote" id="wheelNote">(placeholder result)</div>
  </div>

  <!-- 10) HOLD HEARTBEAT -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">10) Hold to feel my heartbeat ‚ù§Ô∏è‚Äçüî•</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Press and hold. (Reveals a message after a moment.)
    </p>

    <div class="divider"></div>

    <div class="center">
      <div class="holdBtn" id="holdBtn">
        <div class="beat"></div>
        <div>hold</div>
      </div>
    </div>

    <div id="holdOut" class="hidden" style="margin-top:10px; line-height:1.6; color:#444; text-align:center;">
      <div class="divider"></div>
      (placeholder heartbeat message)
    </div>
  </div>

  <!-- FINAL SURPRISE (unlocks after completing certain interactions) -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">Final surprise üåô</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      This unlocks after you‚Äôve played with a few things.
    </p>

    <div class="lockRow">
      <div>Progress:</div>
      <div id="progressPill" class="pill" style="margin:0;">0 / 6</div>
    </div>

    <div class="center">
      <button id="finalBtn" class="secondary" disabled onclick="openFinal()">Locked</button>
    </div>

    <div id="finalOut" class="hidden" style="margin-top:10px; line-height:1.65; color:#444;">
      <div class="divider"></div>
      <strong style="color:var(--deep);">For Taylor üíó</strong>
      <p style="margin:8px 0 0;">(placeholder final message ‚Äî you‚Äôll give me this later)</p>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast">
    <div class="toastTop">
      <div class="toastTitle" id="toastTitle">Note</div>
      <button class="toastClose" onclick="closeToast()">‚úï</button>
    </div>
    <div class="toastBody" id="toastBody"></div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal" onclick="closeModalIfBackdrop(event)">
    <div class="polaroid">
      <div style="display:flex;justify-content:flex-end;padding:10px 10px 0;">
        <button class="secondary" onclick="closeModal()">Close</button>
      </div>
      <img id="modalImg" src="" alt="Memory large">
      <div class="polaroidBottom">
        <div class="captionTitle" id="capTitle">Memory</div>
        <p class="captionText" id="capText">(placeholder caption)</p>
      </div>
    </div>
  </div>

  <script>
    // ===== ambient hearts (cute + romantic) =====
    setInterval(() => {
      const h = document.createElement("div");
      h.className = "floatHeart";
      h.textContent = Math.random() > 0.5 ? "‚ù§Ô∏è" : "üíó";
      h.style.left = (Math.random() * 100) + "vw";
      h.style.animationDuration = (4 + Math.random()*3) + "s";
      h.style.fontSize = (14 + Math.random()*18) + "px";
      document.body.appendChild(h);
      setTimeout(()=>h.remove(), 8000);
    }, 650);

    function burstHearts(){
      for(let i=0;i<12;i++){
        const h = document.createElement("div");
        h.className = "floatHeart";
        h.textContent = Math.random() > 0.5 ? "‚ù§Ô∏è" : "üíó";
        h.style.left = (Math.random() * 100) + "vw";
        h.style.animationDuration = (2.6 + Math.random()*1.8) + "s";
        h.style.fontSize = (16 + Math.random()*20) + "px";
        document.body.appendChild(h);
        setTimeout(()=>h.remove(), 5200);
      }
    }

    // ===== progress unlock system =====
    const progressFlags = {
      maze: false,
      spotify: false,
      memory: false,
      meter: false,
      timeline: false,
      code: false,
      letters: false,
      reasons: false,
      wheel: false,
      hold: false
    };

    // unlock final after 6 interactions (you can change this)
    const FINAL_NEED = 6;

    function markDone(key){
      if(progressFlags[key]) return;
      progressFlags[key] = true;
      updateProgress();
    }

    function updateProgress(){
      const done = Object.values(progressFlags).filter(Boolean).length;
      document.getElementById("progressPill").textContent = `${done} / ${FINAL_NEED}`;
      const btn = document.getElementById("finalBtn");
      if(done >= FINAL_NEED){
        btn.disabled = false;
        btn.classList.remove("secondary");
        btn.textContent = "Open";
      } else {
        btn.disabled = true;
        btn.textContent = "Locked";
        btn.classList.add("secondary");
      }
    }

    function openFinal(){
      document.getElementById("finalOut").style.display = "block";
      showToast("Final surprise üåô", "Unlocked. (placeholder ‚Äî we‚Äôll fill the real message later)");
      burstHearts();
    }

    // ===== toast =====
    function showToast(title, body){
      const t = document.getElementById("toast");
      document.getElementById("toastTitle").textContent = title;
      document.getElementById("toastBody").textContent = body;
      t.style.display = "block";
    }
    function closeToast(){ document.getElementById("toast").style.display = "none"; }

    // ===== 2) Spotify =====
    // Spotify embed needs the "embed" URL. We‚Äôll convert a normal track link.
    function toSpotifyEmbed(link){
      // Examples:
      // https://open.spotify.com/track/{id}?...
      // spotify:track:{id}
      // Embed: https://open.spotify.com/embed/track/{id}
      let id = "";
      if(link.includes("open.spotify.com/track/")){
        id = link.split("open.spotify.com/track/")[1].split("?")[0].split("/")[0];
      } else if(link.startsWith("spotify:track:")){
        id = link.split("spotify:track:")[1];
      } else if(link.includes("/embed/track/")){
        return link; // already embed
      }
      if(!id) return "";
      return `https://open.spotify.com/embed/track/${id}`;
    }

    function setSpotify(){
      const link = (document.getElementById("spotifyLink").value || "").trim();
      const embed = toSpotifyEmbed(link);
      if(!embed){
        showToast("Spotify", "Paste a Spotify track link (Share ‚Üí Copy link).");
        return;
      }
      document.getElementById("spotifyPlayer").src = embed;
      document.getElementById("spotifyPlayerWrap").style.display = "block";
      showToast("Spotify üéµ", "Song set. Tap play on the player.");
      markDone("spotify");
      burstHearts();
    }

    function clearSpotify(){
      document.getElementById("spotifyLink").value = "";
      document.getElementById("spotifyPlayer").src = "";
      document.getElementById("spotifyPlayerWrap").style.display = "none";
    }

    // ===== 3) Memory reveal + modal =====
    const memoryPhotos = [
      { src: "IMG_5847.JPG", title: "That night üíõ", text: "(placeholder caption)" },
      { src: "IMG_5848.JPG", title: "My favorite", text: "(placeholder caption)" },
      { src: "IMG_5852.JPG", title: "Us ü´∂", text: "(placeholder caption)" }
    ];

    document.querySelectorAll("#gallery .thumb").forEach((thumb) => {
      thumb.addEventListener("click", () => {
        const i = Number(thumb.dataset.i);
        if(!thumb.classList.contains("revealed")){
          thumb.classList.add("revealed");
          showToast("Memory üì∏", "(placeholder) Tap again to view bigger.");
          markDone("memory");
          burstHearts();
        } else {
          openModal(i);
        }
      });
    });

    function openModal(i){
      const m = document.getElementById("modal");
      document.getElementById("modalImg").src = memoryPhotos[i].src;
      document.getElementById("capTitle").textContent = memoryPhotos[i].title;
      document.getElementById("capText").textContent  = memoryPhotos[i].text;
      m.style.display = "flex";
      burstHearts();
    }
    function closeModal(){ document.getElementById("modal").style.display = "none"; }
    function closeModalIfBackdrop(e){ if(e.target.id === "modal") closeModal(); }

    // ===== 4) Love meter =====
    const meter = document.getElementById("meter");
    meter.addEventListener("input", () => {
      if(Number(meter.value) >= 110){
        document.getElementById("meterMsg").style.display = "block";
        showToast("Love meter ‚ù§Ô∏è", "(placeholder) You hit ‚àû.");
        markDone("meter");
        burstHearts();
      }
    });

    // ===== 5) Timeline =====
    const timelineCopy = {
      met: "(placeholder: When we met)",
      date: "(placeholder: First date)",
      kiss: "(placeholder: First kiss)",
      ily: "(placeholder: First ‚ÄúI love you‚Äù)"
    };
    function timeline(key){
      document.getElementById("timelineOut").textContent = timelineCopy[key] || "(placeholder)";
      markDone("timeline");
      burstHearts();
    }

    // ===== 6) Code unlock =====
    // We‚Äôll change the code later. Default: "143"
    const SECRET_CODE = "143";
    function unlock(){
      const v = (document.getElementById("codeIn").value || "").trim();
      if(v === SECRET_CODE){
        document.getElementById("codeOut").style.display = "block";
        showToast("Unlocked üîê", "(placeholder) Code accepted.");
        markDone("code");
        burstHearts();
      } else {
        showToast("Nope üòÖ", "Try again. (We‚Äôll set the real code later.)");
      }
    }
    function resetUnlock(){
      document.getElementById("codeIn").value = "";
      document.getElementById("codeOut").style.display = "none";
    }

    // ===== 7) Letters =====
    function openLetter(n){
      document.getElementById("letterTitle").textContent = `Letter ${n}`;
      document.getElementById("letterBody").textContent = "(placeholder letter text ‚Äî coming soon)";
      document.getElementById("letterOut").style.display = "block";
      showToast("Love letter üíå", "(placeholder) Letter opened.");
      markDone("letters");
      burstHearts();
    }

    // ===== 8) Reasons generator =====
    const reasons = [
      "(placeholder reason 1)",
      "(placeholder reason 2)",
      "(placeholder reason 3)",
      "(placeholder reason 4)",
      "(placeholder reason 5)"
    ];
    function nextReason(){
      const pick = reasons[Math.floor(Math.random()*reasons.length)];
      document.getElementById("reasonOut").textContent = pick;
      showToast("Reason üíñ", "(placeholder) Tap again for another.");
      markDone("reasons");
      burstHearts();
    }

    // ===== 9) Wheel =====
    const wheel = document.getElementById("wheel");
    const wheelOptions = [
      "(placeholder option 1)",
      "(placeholder option 2)",
      "(placeholder option 3)",
      "(placeholder option 4)",
      "(placeholder option 5)",
      "(placeholder option 6)"
    ];
    let wheelRot = 0;
    function spin(){
      const spins = 3 + Math.random()*2; // 3‚Äì5 spins
      const extra = Math.random()*360;
      wheelRot += spins*360 + extra;
      wheel.style.transform = `rotate(${wheelRot}deg)`;

      // pick result based on final angle (rough)
      const angle = (360 - (wheelRot % 360)) % 360;
      const idx = Math.floor(angle / (360 / wheelOptions.length));
      const result = wheelOptions[idx] || "(placeholder)";
      document.getElementById("wheelNote").textContent = result;

      showToast("Wheel üé°", "It landed on: " + result);
      markDone("wheel");
      burstHearts();
    }

    // ===== 10) Hold heartbeat =====
    const holdBtn = document.getElementById("holdBtn");
    let holdTimer = null;

    function startHold(){
      holdBtn.classList.add("beating");
      holdTimer = setTimeout(() => {
        document.getElementById("holdOut").style.display = "block";
        showToast("Heartbeat ‚ù§Ô∏è‚Äçüî•", "(placeholder) Message revealed.");
        markDone("hold");
        burstHearts();
      }, 1400); // hold 1.4s
    }
    function endHold(){
      holdBtn.classList.remove("beating");
      if(holdTimer) clearTimeout(holdTimer);
      holdTimer = null;
    }

    // mobile-friendly press/hold
    holdBtn.addEventListener("touchstart", (e)=>{ e.preventDefault(); startHold(); }, {passive:false});
    holdBtn.addEventListener("touchend", (e)=>{ e.preventDefault(); endHold(); }, {passive:false});
    holdBtn.addEventListener("mousedown", startHold);
    holdBtn.addEventListener("mouseup", endHold);
    holdBtn.addEventListener("mouseleave", endHold);

    // ===== 1) Maze (touch drag) =====
    const canvas = document.getElementById("maze");
    const ctx = canvas.getContext("2d");

    // Grid-based medium maze (0=path, 1=wall)
    // You can swap this later if you want more/less difficult.
    const maze = [
      [1,1,1,1,1,1,1,1,1,1,1,1],
      [1,0,0,0,1,0,0,0,0,0,0,1],
      [1,0,1,0,1,0,1,1,1,1,0,1],
      [1,0,1,0,0,0,0,0,0,1,0,1],
      [1,0,1,1,1,1,1,1,0,1,0,1],
      [1,0,0,0,0,0,0,1,0,1,0,1],
      [1,1,1,1,1,1,0,1,0,1,0,1],
      [1,0,0,0,0,1,0,0,0,1,0,1],
      [1,0,1,1,0,1,1,1,0,1,0,1],
      [1,0,0,1,0,0,0,1,0,0,0,1],
      [1,1,0,0,0,1,0,0,0,1,0,1],
      [1,1,1,1,1,1,1,1,1,1,1,1]
    ];

    const rows = maze.length;
    const cols = maze[0].length;

    const startCell = { r:1, c:1 };
    const endCell   = { r:10, c:10 };

    const cellSize = canvas.width / cols;

    let player = { x: (startCell.c + 0.5)*cellSize, y: (startCell.r + 0.5)*cellSize, r: cellSize*0.22 };
    let dragging = false;
    let won = false;

    function drawMaze(){
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // walls + paths
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          ctx.fillStyle = maze[r][c] === 1 ? "rgba(214,51,108,0.18)" : "rgba(255,255,255,1)";
          ctx.fillRect(c*cellSize, r*cellSize, cellSize, cellSize);
        }
      }

      // start/end
      ctx.fillStyle = "rgba(255,77,109,0.16)";
      ctx.fillRect(startCell.c*cellSize, startCell.r*cellSize, cellSize, cellSize);

      ctx.fillStyle = "rgba(214,51,108,0.22)";
      ctx.fillRect(endCell.c*cellSize, endCell.r*cellSize, cellSize, cellSize);

      // grid lines (subtle)
      ctx.strokeStyle = "rgba(0,0,0,0.06)";
      for(let i=0;i<=cols;i++){
        ctx.beginPath();
        ctx.moveTo(i*cellSize, 0);
        ctx.lineTo(i*cellSize, canvas.height);
        ctx.stroke();
      }
      for(let i=0;i<=rows;i++){
        ctx.beginPath();
        ctx.moveTo(0, i*cellSize);
        ctx.lineTo(canvas.width, i*cellSize);
        ctx.stroke();
      }

      // player heart
      ctx.beginPath();
      ctx.fillStyle = "rgba(255,77,109,0.95)";
      ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
      ctx.fill();

      // tiny heart icon on top
      ctx.fillStyle = "#fff";
      ctx.font = `${Math.floor(player.r*1.4)}px Georgia`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("‚ô•", player.x, player.y + 1);
    }

    function pointInPlayer(px, py){
      const dx = px - player.x;
      const dy = py - player.y;
      return Math.hypot(dx,dy) <= player.r*1.2;
    }

    function cellAt(px, py){
      const c = Math.floor(px / cellSize);
      const r = Math.floor(py / cellSize);
      return { r, c };
    }

    function isWall(px, py){
      const {r,c} = cellAt(px, py);
      if(r<0 || c<0 || r>=rows || c>=cols) return true;
      return maze[r][c] === 1;
    }

    function tryMove(px, py){
      if(won) return;

      // collision check by sampling around player's circle
      const samples = [
        [0,0],
        [player.r,0],
        [-player.r,0],
        [0,player.r],
        [0,-player.r],
        [player.r*0.7, player.r*0.7],
        [player.r*0.7, -player.r*0.7],
        [-player.r*0.7, player.r*0.7],
        [-player.r*0.7, -player.r*0.7],
      ];

      for(const [sx,sy] of samples){
        if(isWall(px+sx, py+sy)) return; // blocked
      }

      player.x = px;
      player.y = py;

      // win check
      const {r,c} = cellAt(player.x, player.y);
      if(r === endCell.r && c === endCell.c){
        won = true;
        document.getElementById("mazeWin").style.display = "block";
        showToast("Maze üíò", "You made it. (placeholder secret message)");
        markDone("maze");
        burstHearts();
      }

      drawMaze();
    }

    function canvasPosFromEvent(e){
      const rect = canvas.getBoundingClientRect();
      let clientX, clientY;
      if(e.touches && e.touches[0]){
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
      } else {
        clientX = e.clientX;
        clientY = e.clientY;
      }

      // account for canvas CSS scaling
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;

      return {
        x: (clientX - rect.left) * scaleX,
        y: (clientY - rect.top) * scaleY
      };
    }

    canvas.addEventListener("touchstart", (e)=>{
      e.preventDefault();
      const p = canvasPosFromEvent(e);
      if(pointInPlayer(p.x,p.y)) dragging = true;
    }, {passive:false});

    canvas.addEventListener("touchmove", (e)=>{
      e.preventDefault();
      if(!dragging) return;
      const p = canvasPosFromEvent(e);
      tryMove(p.x,p.y);
    }, {passive:false});

    canvas.addEventListener("touchend", (e)=>{
      e.preventDefault();
      dragging = false;
    }, {passive:false});

    // optional mouse support (desktop testing)
    canvas.addEventListener("mousedown", (e)=>{
      const p = canvasPosFromEvent(e);
      if(pointInPlayer(p.x,p.y)) dragging = true;
    });
    canvas.addEventListener("mousemove", (e)=>{
      if(!dragging) return;
      const p = canvasPosFromEvent(e);
      tryMove(p.x,p.y);
    });
    window.addEventListener("mouseup", ()=> dragging=false);

    function resetMaze(){
      won = false;
      dragging = false;
      player = { x: (startCell.c + 0.5)*cellSize, y: (startCell.r + 0.5)*cellSize, r: cellSize*0.22 };
      document.getElementById("mazeWin").style.display = "none";
      drawMaze();
      showToast("Maze reset", "Go again üòâ");
    }

    // initial draw
    drawMaze();
    updateProgress();
  </script>
</body>
</html>

