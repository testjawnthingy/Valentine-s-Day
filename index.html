<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>For Taylor ‚ù§Ô∏è</title>

  <style>
    :root{
      --pink:#ff4d6d;
      --deep:#d6336c;
      --bg1:#fff6fa;
      --bg2:#ffe0ea;
      --card:#ffffff;
      --ink:#2b2b2b;
      --muted:#6b6b6b;
      --shadow: 0 12px 28px rgba(0,0,0,0.10);
      --shadow2: 0 18px 55px rgba(0,0,0,0.18);
      --line: rgba(0,0,0,0.08);
      --good: rgba(35, 176, 97, 0.22);
      --goal: rgba(255, 193, 7, 0.25);
      --wall: rgba(214,51,108,0.18);
      --path: rgba(255,255,255,1);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Georgia, "Times New Roman", serif;
      background: radial-gradient(circle at top, var(--bg1) 0%, #ffeef2 45%, var(--bg2) 100%);
      color:var(--ink);
      text-align:center;
      padding: 24px 14px 90px;
      overflow-x:hidden;
    }
    h1{
      margin: 12px 0 6px;
      color:var(--deep);
      font-size: 2.05rem;
      letter-spacing: 0.2px;
    }
    .sub{
      margin:0 0 16px;
      opacity:0.92;
      font-size: 1.02rem;
    }

    .card{
      background: var(--card);
      padding: 18px 16px;
      border-radius: 16px;
      box-shadow: var(--shadow);
      max-width: 620px;
      margin: 14px auto;
      text-align:left;
      position: relative;
      z-index: 2;
    }
    .center{ text-align:center; }
    .divider{
      height:1px;
      background: var(--line);
      margin: 14px 0;
    }
    .small{
      font-size: 0.92rem;
      color:var(--muted);
      margin-top: 6px;
      text-align:center;
      line-height:1.35;
    }

    .pillrow{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:center;
      margin-top: 10px;
    }
    .pill{
      padding:8px 10px;
      border-radius: 999px;
      background: #fff0f5;
      border: 1px solid rgba(214,51,108,0.18);
      font-size: 0.95rem;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    button{
      background: var(--pink);
      border: none;
      color: white;
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 1.02rem;
      cursor: pointer;
      margin: 8px 6px;
      box-shadow: 0 10px 20px rgba(255,77,109,0.25);
      transition: transform .08s ease, filter .08s ease;
      -webkit-tap-highlight-color: transparent;
    }
    button:active{ transform: translateY(1px) scale(0.99); }
    button.secondary{
      background:#fff;
      color:var(--deep);
      border:1px solid rgba(214,51,108,0.22);
      box-shadow:none;
    }
    button:disabled{
      opacity:0.55;
      cursor:not-allowed;
    }
    .hidden{ display:none; }

    /* Ambient hearts */
    .floatHeart{
      position: fixed;
      bottom: -24px;
      user-select:none;
      pointer-events:none;
      opacity: 0.8;
      animation: floatUp linear forwards;
      z-index: 1;
    }
    @keyframes floatUp{
      from { transform: translateY(0) scale(0.9); opacity:0.85; }
      to   { transform: translateY(-120vh) scale(1.35); opacity:0; }
    }

    /* Toast */
    .toast{
      position: fixed;
      left: 50%;
      bottom: 18px;
      transform: translateX(-50%);
      max-width: 92vw;
      width: 590px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: var(--shadow2);
      border: 1px solid rgba(214,51,108,0.18);
      padding: 14px 14px;
      text-align:left;
      z-index: 9999;
      display:none;
    }
    .toastTop{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }
    .toastTitle{
      font-weight:700;
      color:var(--deep);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .toastClose{
      background:transparent;
      border:none;
      color:#999;
      font-size: 18px;
      cursor:pointer;
      padding: 6px 10px;
      border-radius: 10px;
      box-shadow:none;
      margin:0;
    }
    .toastBody{
      margin-top:8px;
      line-height:1.55;
      font-size: 1.02rem;
    }

    /* Maze */
    .mazeWrap{
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(255,255,255,0.82), rgba(255,240,245,0.92));
      border: 1px solid rgba(214,51,108,0.12);
      overflow:hidden;
      padding: 10px;
      margin-top: 12px;
    }
    canvas{
      width: 100%;
      height: auto;
      display:block;
      border-radius: 12px;
      background: #fff;
      border: 1px solid rgba(0,0,0,0.08);
      touch-action: none; /* critical for iPhone drag */
    }

    /* Memory */
    .gallery{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
    }
    .thumb{
      position:relative;
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(0,0,0,0.08);
      box-shadow: 0 10px 18px rgba(0,0,0,0.08);
      cursor:pointer;
      background:#fff;
      aspect-ratio: 1 / 1;
      user-select:none;
    }
    .thumb img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      transform: scale(1.03);
      filter: blur(12px);
      transition: filter .25s ease;
    }
    .thumb.revealed img{ filter: blur(0); }
    .thumb::after{
      content:"tap";
      position:absolute;
      right:8px;
      bottom:8px;
      background: rgba(255,255,255,0.88);
      border: 1px solid rgba(214,51,108,0.18);
      color: var(--deep);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      font-size: 0.75rem;
      padding: 4px 8px;
      border-radius:999px;
    }

    /* Modal */
    .modal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 9998;
    }
    .polaroid{
      width: min(92vw, 560px);
      background:#fff;
      border-radius: 18px;
      box-shadow: var(--shadow2);
      overflow:hidden;
      border: 1px solid rgba(255,255,255,0.15);
    }
    .polaroid img{
      width:100%;
      height:auto;
      display:block;
    }
    .polaroidBottom{
      padding: 12px 14px 16px;
    }
    .captionTitle{
      color:var(--deep);
      font-weight:700;
      margin: 0 0 6px;
      font-size: 1.05rem;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .captionText{
      margin:0;
      color:#444;
      opacity:0.95;
      line-height:1.45;
    }

    /* Love meter */
    input[type="range"]{ width: 100%; margin: 12px 0 6px; }
    .meterRow{
      display:flex;
      justify-content:space-between;
      color:var(--muted);
      font-size:0.92rem;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    /* Envelopes */
    .envGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:10px;
      margin-top:10px;
    }
    .env{
      border-radius: 14px;
      border: 1px solid rgba(214,51,108,0.18);
      background: #fff0f5;
      box-shadow: 0 10px 18px rgba(0,0,0,0.06);
      padding: 12px 10px;
      text-align:center;
      cursor:pointer;
      user-select:none;
    }
    .env .icon{ font-size: 22px; }
    .env .lbl{
      margin-top:6px;
      font-size:0.92rem;
      color:#444;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    /* Wheel */
    .wheelBox{
      position:relative;
      height: 220px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(255,255,255,0.82), rgba(255,240,245,0.9));
      border: 1px solid rgba(214,51,108,0.12);
      overflow:hidden;
      display:grid;
      place-items:center;
    }
    .wheel{
      width: 160px;
      height: 160px;
      border-radius: 50%;
      border: 10px solid rgba(214,51,108,0.12);
      background: conic-gradient(
        rgba(255,77,109,0.25) 0 60deg,
        rgba(214,51,108,0.20) 60deg 120deg,
        rgba(255,77,109,0.18) 120deg 180deg,
        rgba(214,51,108,0.16) 180deg 240deg,
        rgba(255,77,109,0.22) 240deg 300deg,
        rgba(214,51,108,0.18) 300deg 360deg
      );
      transition: transform 1.4s cubic-bezier(.15,.85,.12,1);
    }
    .pointer{
      position:absolute;
      top: 16px;
      width: 0; height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-bottom: 18px solid rgba(214,51,108,0.75);
    }
    .wheelNote{
      text-align:center;
      margin-top:10px;
      color:#444;
      opacity:.95;
      min-height: 24px;
    }

    /* Big Heartbeat */
    .bigHeartWrap{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:10px;
      margin-top: 12px;
    }
    .bigHeart{
      width: 130px;
      height: 130px;
      display:grid;
      place-items:center;
      border-radius: 28px;
      background: #fff0f5;
      border: 1px solid rgba(214,51,108,0.22);
      box-shadow: 0 12px 22px rgba(0,0,0,0.08);
      user-select:none;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
    }
    .bigHeart span{
      font-size: 72px;
      transform: translateY(2px);
      filter: drop-shadow(0 10px 18px rgba(255,77,109,0.18));
    }
    .pulsing .bigHeart{
      animation: pulse 0.62s infinite;
    }
    @keyframes pulse{
      0%   { transform: scale(1); }
      50%  { transform: scale(1.10); }
      100% { transform: scale(1); }
    }
    .hintText{
      color:var(--muted);
      font-size:0.95rem;
      text-align:center;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    /* Final */
    .lockRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:10px;
      margin-top:10px;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      color:var(--muted);
      font-size:0.92rem;
    }

    /* Spotify player (revealed after maze) */
    .spotifyWrap{
      margin-top: 10px;
    }
    iframe{
      border-radius:14px;
      border:1px solid rgba(0,0,0,0.08);
      width:100%;
      height:152px;
    }
  </style>
</head>

<body>
  <h1>Taylor ‚ù§Ô∏è</h1>
  <p class="sub">A little Valentine‚Äôs page ‚Äî made just for you.</p>

  <div class="card center">
    <div class="pillrow">
      <div class="pill">üß© maze secret</div>
      <div class="pill">üì∏ tap memories</div>
      <div class="pill">üíå letters</div>
      <div class="pill">üé° spin</div>
      <div class="pill">‚ù§Ô∏è big heartbeat</div>
    </div>
    <p class="small">Save this link. It‚Äôs yours forever.</p>
  </div>

  <!-- 1) MAZE -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">1) The Love Maze üß©</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Drag the heart from <strong>START</strong> to <strong>END</strong>. When you reach the end, you‚Äôll unlock a secret message (and the song).
    </p>

    <div class="mazeWrap">
      <canvas id="maze" width="420" height="420" aria-label="Love Maze"></canvas>
    </div>

    <div class="center">
      <button class="secondary" onclick="resetMaze()">Reset maze</button>
    </div>

    <div id="mazeWin" class="hidden" style="margin-top:10px; line-height:1.6; color:#444;">
      <div class="divider"></div>
      <strong style="color:var(--deep);">Maze complete üíò</strong>
      <p style="margin:8px 0 0;">
        (placeholder secret message ‚Äî you‚Äôll give me this later)
      </p>
    </div>

    <!-- Spotify appears only AFTER maze is complete -->
    <div id="spotifySection" class="hidden">
      <div class="divider"></div>
      <strong style="color:var(--deep);">Now play our song üéµ</strong>
      <p style="margin:8px 0 10px;color:#444;opacity:.92;line-height:1.55;">
        iPhone won‚Äôt let websites force Spotify autoplay ‚Äî but once you tap play one time, it can keep going while you do everything else.
      </p>

      <!-- IMPORTANT: Paste the Spotify TRACK link here once you have it.
           Example: https://open.spotify.com/track/XXXXXXXXXXXX -->
      <div class="spotifyWrap">
        <iframe
          id="spotifyPlayer"
          src=""
          allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
          loading="lazy">
        </iframe>
      </div>
      <p class="small">(placeholder ‚Äî I‚Äôll wire the exact Olivia Dean track once you paste the Spotify link)</p>
    </div>
  </div>

  <!-- 2) Tap to Reveal A Memory -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">2) Tap to Reveal A Memory üì∏</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Tap a photo once to unblur it. Tap again to view it bigger.
    </p>

    <div class="divider"></div>

    <div class="gallery" id="gallery">
      <div class="thumb" data-i="0"><img src="IMG_5847.JPG" alt="Memory 1"></div>
      <div class="thumb" data-i="1"><img src="IMG_5848.JPG" alt="Memory 2"></div>
      <div class="thumb" data-i="2"><img src="IMG_5852.JPG" alt="Memory 3"></div>
    </div>

    <p class="small">(placeholders ‚Äî we‚Äôll add captions later)</p>
  </div>

  <!-- 3) Love meter -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">3) Love meter ‚ù§Ô∏è</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Slide it all the way. (There‚Äôs a surprise at the end.)
    </p>

    <div class="divider"></div>

    <input id="meter" type="range" min="0" max="110" value="0" />
    <div class="meterRow">
      <span>0</span><span>50</span><span>100</span><span>‚àû</span>
    </div>

    <div id="meterMsg" class="hidden" style="margin-top:10px; line-height:1.6; color:#444;">
      <div class="divider"></div>
      <strong style="color:var(--deep);">Unlocked üíó</strong>
      <p style="margin:8px 0 0;">(placeholder love-meter message)</p>
    </div>
  </div>

  <!-- 4) Love letters -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">4) Love letters üíå</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Tap an envelope to open a letter. (Placeholders for now.)
    </p>

    <div class="envGrid">
      <div class="env" onclick="openLetter(1)"><div class="icon">üíå</div><div class="lbl">Letter 1</div></div>
      <div class="env" onclick="openLetter(2)"><div class="icon">üíå</div><div class="lbl">Letter 2</div></div>
      <div class="env" onclick="openLetter(3)"><div class="icon">üíå</div><div class="lbl">Letter 3</div></div>
    </div>

    <div id="letterOut" class="hidden" style="margin-top:10px; line-height:1.65; color:#444;">
      <div class="divider"></div>
      <strong id="letterTitle" style="color:var(--deep);">Letter</strong>
      <p id="letterBody" style="margin:8px 0 0;">(placeholder letter text)</p>
    </div>
  </div>

  <!-- 5) Reasons generator -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">5) Reasons I love you üíñ</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Tap for a reason. (We‚Äôll load your real reasons later.)
    </p>

    <div class="center">
      <button onclick="nextReason()">Give me one</button>
    </div>

    <div id="reasonOut" style="margin-top:10px; line-height:1.65; color:#444; text-align:center;">
      (placeholder reason)
    </div>
  </div>

  <!-- 6) Spin wheel -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">6) Spin the wheel üé°</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Tap spin. It lands on something cute. (We‚Äôll customize the options later.)
    </p>

    <div class="divider"></div>

    <div class="wheelBox">
      <div class="pointer"></div>
      <div class="wheel" id="wheel"></div>
    </div>

    <div class="center">
      <button onclick="spin()">Spin</button>
    </div>

    <div class="wheelNote" id="wheelNote">(placeholder result)</div>
  </div>

  <!-- 7) Big Heartbeat -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">7) Heartbeat ‚ù§Ô∏è</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      Press and hold the big heart for a moment.
    </p>

    <div class="bigHeartWrap" id="hbWrap">
      <div class="bigHeart" id="bigHeart" role="button" aria-label="Hold heart">
        <span>‚ù§Ô∏è</span>
      </div>
      <div class="hintText">hold to feel it</div>
    </div>

    <div id="holdOut" class="hidden" style="margin-top:10px; line-height:1.6; color:#444; text-align:center;">
      <div class="divider"></div>
      (placeholder heartbeat message)
    </div>
  </div>

  <!-- Final surprise -->
  <div class="card">
    <h2 style="margin:0 0 8px;color:var(--deep);">Final surprise üåô</h2>
    <p style="margin:0;color:#444;opacity:.92;line-height:1.55;">
      This unlocks after you‚Äôve played with a few things.
    </p>

    <div class="lockRow">
      <div>Progress:</div>
      <div id="progressPill" class="pill" style="margin:0;">0 / 5</div>
    </div>

    <div class="center">
      <button id="finalBtn" class="secondary" disabled onclick="openFinal()">Locked</button>
    </div>

    <div id="finalOut" class="hidden" style="margin-top:10px; line-height:1.65; color:#444;">
      <div class="divider"></div>
      <strong style="color:var(--deep);">For Taylor üíó</strong>
      <p style="margin:8px 0 0;">(placeholder final message ‚Äî you‚Äôll give me this later)</p>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast">
    <div class="toastTop">
      <div class="toastTitle" id="toastTitle">Note</div>
      <button class="toastClose" onclick="closeToast()">‚úï</button>
    </div>
    <div class="toastBody" id="toastBody"></div>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal" onclick="closeModalIfBackdrop(event)">
    <div class="polaroid">
      <div style="display:flex;justify-content:flex-end;padding:10px 10px 0;">
        <button class="secondary" onclick="closeModal()">Close</button>
      </div>
      <img id="modalImg" src="" alt="Memory large">
      <div class="polaroidBottom">
        <div class="captionTitle" id="capTitle">Memory</div>
        <p class="captionText" id="capText">(placeholder caption)</p>
      </div>
    </div>
  </div>

  <script>
    // ===== ambient hearts =====
    setInterval(() => {
      const h = document.createElement("div");
      h.className = "floatHeart";
      h.textContent = Math.random() > 0.5 ? "‚ù§Ô∏è" : "üíó";
      h.style.left = (Math.random() * 100) + "vw";
      h.style.animationDuration = (4 + Math.random()*3) + "s";
      h.style.fontSize = (14 + Math.random()*18) + "px";
      document.body.appendChild(h);
      setTimeout(()=>h.remove(), 8000);
    }, 650);

    function burstHearts(){
      for(let i=0;i<12;i++){
        const h = document.createElement("div");
        h.className = "floatHeart";
        h.textContent = Math.random() > 0.5 ? "‚ù§Ô∏è" : "üíó";
        h.style.left = (Math.random() * 100) + "vw";
        h.style.animationDuration = (2.6 + Math.random()*1.8) + "s";
        h.style.fontSize = (16 + Math.random()*20) + "px";
        document.body.appendChild(h);
        setTimeout(()=>h.remove(), 5200);
      }
    }

    // ===== toast =====
    function showToast(title, body){
      const t = document.getElementById("toast");
      document.getElementById("toastTitle").textContent = title;
      document.getElementById("toastBody").textContent = body;
      t.style.display = "block";
    }
    function closeToast(){ document.getElementById("toast").style.display = "none"; }

    // ===== progress unlock system (FINAL after 5 interactions) =====
    const progressFlags = {
      maze: false,
      memory: false,
      meter: false,
      letters: false,
      reasons: false,
      wheel: false,
      heartbeat: false
    };
    const FINAL_NEED = 5;

    function markDone(key){
      if(progressFlags[key]) return;
      progressFlags[key] = true;
      updateProgress();
    }

    function updateProgress(){
      const done = Object.values(progressFlags).filter(Boolean).length;
      document.getElementById("progressPill").textContent = `${done} / ${FINAL_NEED}`;
      const btn = document.getElementById("finalBtn");
      if(done >= FINAL_NEED){
        btn.disabled = false;
        btn.classList.remove("secondary");
        btn.textContent = "Open";
      } else {
        btn.disabled = true;
        btn.textContent = "Locked";
        btn.classList.add("secondary");
      }
    }

    function openFinal(){
      document.getElementById("finalOut").style.display = "block";
      showToast("Final surprise üåô", "Unlocked. (placeholder ‚Äî we‚Äôll fill the real message later)");
      burstHearts();
    }

    // ===== Love meter =====
    const meter = document.getElementById("meter");
    meter.addEventListener("input", () => {
      if(Number(meter.value) >= 110){
        document.getElementById("meterMsg").style.display = "block";
        showToast("Love meter ‚ù§Ô∏è", "(placeholder) You hit ‚àû.");
        markDone("meter");
        burstHearts();
      }
    });

    // ===== Letters =====
    function openLetter(n){
      document.getElementById("letterTitle").textContent = `Letter ${n}`;
      document.getElementById("letterBody").textContent = "(placeholder letter text ‚Äî coming soon)";
      document.getElementById("letterOut").style.display = "block";
      showToast("Love letter üíå", "(placeholder) Letter opened.");
      markDone("letters");
      burstHearts();
    }

    // ===== Reasons generator =====
    const reasons = [
      "(placeholder reason 1)",
      "(placeholder reason 2)",
      "(placeholder reason 3)",
      "(placeholder reason 4)",
      "(placeholder reason 5)"
    ];
    function nextReason(){
      const pick = reasons[Math.floor(Math.random()*reasons.length)];
      document.getElementById("reasonOut").textContent = pick;
      showToast("Reason üíñ", "(placeholder) Tap again for another.");
      markDone("reasons");
      burstHearts();
    }

    // ===== Wheel =====
    const wheel = document.getElementById("wheel");
    const wheelOptions = [
      "(placeholder option 1)",
      "(placeholder option 2)",
      "(placeholder option 3)",
      "(placeholder option 4)",
      "(placeholder option 5)",
      "(placeholder option 6)"
    ];
    let wheelRot = 0;
    function spin(){
      const spins = 3 + Math.random()*2;
      const extra = Math.random()*360;
      wheelRot += spins*360 + extra;
      wheel.style.transform = `rotate(${wheelRot}deg)`;

      const angle = (360 - (wheelRot % 360)) % 360;
      const idx = Math.floor(angle / (360 / wheelOptions.length));
      const result = wheelOptions[idx] || "(placeholder)";
      document.getElementById("wheelNote").textContent = result;

      showToast("Wheel üé°", "It landed on: " + result);
      markDone("wheel");
      burstHearts();
    }

    // ===== Big Heartbeat (hold to reveal) =====
    const hbWrap = document.getElementById("hbWrap");
    const bigHeart = document.getElementById("bigHeart");
    let holdTimer = null;
    let revealed = false;

    function startHold(){
      if(revealed) return;
      hbWrap.classList.add("pulsing");
      holdTimer = setTimeout(() => {
        revealed = true;
        document.getElementById("holdOut").style.display = "block";
        showToast("Heartbeat ‚ù§Ô∏è", "(placeholder) Message revealed.");
        markDone("heartbeat");
        burstHearts();
      }, 1400);
    }
    function endHold(){
      hbWrap.classList.remove("pulsing");
      if(holdTimer) clearTimeout(holdTimer);
      holdTimer = null;
    }

    bigHeart.addEventListener("touchstart", (e)=>{ e.preventDefault(); startHold(); }, {passive:false});
    bigHeart.addEventListener("touchend", (e)=>{ e.preventDefault(); endHold(); }, {passive:false});
    bigHeart.addEventListener("mousedown", startHold);
    bigHeart.addEventListener("mouseup", endHold);
    bigHeart.addEventListener("mouseleave", endHold);

    // ===== Memory reveal + modal =====
    const memoryPhotos = [
      { src: "IMG_5847.JPG", title: "That night üíõ", text: "(placeholder caption)" },
      { src: "IMG_5848.JPG", title: "My favorite", text: "(placeholder caption)" },
      { src: "IMG_5852.JPG", title: "Us ü´∂", text: "(placeholder caption)" }
    ];

    document.querySelectorAll("#gallery .thumb").forEach((thumb) => {
      thumb.addEventListener("click", () => {
        const i = Number(thumb.dataset.i);
        if(!thumb.classList.contains("revealed")){
          thumb.classList.add("revealed");
          showToast("Memory üì∏", "(placeholder) Tap again to view bigger.");
          markDone("memory");
          burstHearts();
        } else {
          openModal(i);
        }
      });
    });

    function openModal(i){
      const m = document.getElementById("modal");
      document.getElementById("modalImg").src = memoryPhotos[i].src;
      document.getElementById("capTitle").textContent = memoryPhotos[i].title;
      document.getElementById("capText").textContent  = memoryPhotos[i].text;
      m.style.display = "flex";
      burstHearts();
    }
    function closeModal(){ document.getElementById("modal").style.display = "none"; }
    function closeModalIfBackdrop(e){ if(e.target.id === "modal") closeModal(); }

    // ===== Spotify embed (revealed AFTER maze) =====
    // Paste your Spotify track link here when you have it:
    // Example: const SPOTIFY_TRACK_LINK = "https://open.spotify.com/track/XXXXXXXX";
    const SPOTIFY_TRACK_LINK = "https://open.spotify.com/track/6sGIMrtIzQjdzNndVxe397?si=28d9c50f72cb4432";

    function toSpotifyEmbed(link){
      let id = "";
      if(link.includes("open.spotify.com/track/")){
        id = link.split("open.spotify.com/track/")[1].split("?")[0].split("/")[0];
      } else if(link.startsWith("spotify:track:")){
        id = link.split("spotify:track:")[1];
      } else if(link.includes("/embed/track/")){
        return link;
      }
      if(!id) return "";
      return `https://open.spotify.com/embed/track/${id}`;
    }

    function revealSpotify(){
      const sec = document.getElementById("spotifySection");
      const iframe = document.getElementById("spotifyPlayer");
      const embed = toSpotifyEmbed(SPOTIFY_TRACK_LINK);

      sec.style.display = "block";

      if(embed){
        iframe.src = embed;
      } else {
        // still show section but without a valid src
        iframe.src = "";
      }
    }

    // ===== MAZE (harder + clear start/end) =====
    const canvas = document.getElementById("maze");
    const ctx = canvas.getContext("2d");

    // Harder maze: bigger grid and narrower routes
    // 0 = path, 1 = wall
    const maze = [
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
      [1,0,0,0,1,0,0,0,1,0,0,0,0,0,1],
      [1,0,1,0,1,0,1,0,1,0,1,1,1,0,1],
      [1,0,1,0,0,0,1,0,0,0,0,0,1,0,1],
      [1,0,1,1,1,0,1,1,1,1,1,0,1,0,1],
      [1,0,0,0,1,0,0,0,0,0,1,0,1,0,1],
      [1,1,1,0,1,1,1,1,1,0,1,0,1,0,1],
      [1,0,0,0,0,0,0,0,1,0,0,0,1,0,1],
      [1,0,1,1,1,1,1,0,1,1,1,0,1,0,1],
      [1,0,1,0,0,0,1,0,0,0,1,0,0,0,1],
      [1,0,1,0,1,0,1,1,1,0,1,1,1,0,1],
      [1,0,0,0,1,0,0,0,1,0,0,0,1,0,1],
      [1,0,1,1,1,1,1,0,1,1,1,0,1,0,1],
      [1,0,0,0,0,0,0,0,0,0,1,0,0,0,1],
      [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
    ];

    const rows = maze.length;
    const cols = maze[0].length;

    // Clear start/end positions
    const startCell = { r:1, c:1 };
    const endCell   = { r:13, c:13 };

    const cellSize = canvas.width / cols;

    let player = { x: (startCell.c + 0.5)*cellSize, y: (startCell.r + 0.5)*cellSize, r: cellSize*0.22 };
    let dragging = false;
    let won = false;

    function drawMaze(){
      ctx.clearRect(0,0,canvas.width,canvas.height);

      // tiles
      for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
          let fill = (maze[r][c] === 1) ? getComputedStyle(document.documentElement).getPropertyValue('--wall') : getComputedStyle(document.documentElement).getPropertyValue('--path');
          ctx.fillStyle = fill;
          ctx.fillRect(c*cellSize, r*cellSize, cellSize, cellSize);
        }
      }

      // start/end blocks
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--good');
      ctx.fillRect(startCell.c*cellSize, startCell.r*cellSize, cellSize, cellSize);

      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--goal');
      ctx.fillRect(endCell.c*cellSize, endCell.r*cellSize, cellSize, cellSize);

      // labels
      ctx.fillStyle = "rgba(30,30,30,0.70)";
      ctx.font = `${Math.floor(cellSize*0.32)}px ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("START", (startCell.c+0.5)*cellSize, (startCell.r+0.5)*cellSize);
      ctx.fillText("END", (endCell.c+0.5)*cellSize, (endCell.r+0.5)*cellSize);

      // subtle grid
      ctx.strokeStyle = "rgba(0,0,0,0.06)";
      for(let i=0;i<=cols;i++){
        ctx.beginPath(); ctx.moveTo(i*cellSize, 0); ctx.lineTo(i*cellSize, canvas.height); ctx.stroke();
      }
      for(let i=0;i<=rows;i++){
        ctx.beginPath(); ctx.moveTo(0, i*cellSize); ctx.lineTo(canvas.width, i*cellSize); ctx.stroke();
      }

      // player heart
      ctx.beginPath();
      ctx.fillStyle = "rgba(255,77,109,0.95)";
      ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
      ctx.fill();

      ctx.fillStyle = "#fff";
      ctx.font = `${Math.floor(player.r*1.4)}px Georgia`;
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText("‚ô•", player.x, player.y + 1);
    }

    function pointInPlayer(px, py){
      const dx = px - player.x;
      const dy = py - player.y;
      return Math.hypot(dx,dy) <= player.r*1.2;
    }

    function cellAt(px, py){
      const c = Math.floor(px / cellSize);
      const r = Math.floor(py / cellSize);
      return { r, c };
    }

    function isWall(px, py){
      const {r,c} = cellAt(px, py);
      if(r<0 || c<0 || r>=rows || c>=cols) return true;
      return maze[r][c] === 1;
    }

    function tryMove(px, py){
      if(won) return;

      const samples = [
        [0,0],
        [player.r,0],
        [-player.r,0],
        [0,player.r],
        [0,-player.r],
        [player.r*0.7, player.r*0.7],
        [player.r*0.7, -player.r*0.7],
        [-player.r*0.7, player.r*0.7],
        [-player.r*0.7, -player.r*0.7],
      ];

      for(const [sx,sy] of samples){
        if(isWall(px+sx, py+sy)) return;
      }

      player.x = px;
      player.y = py;

      const {r,c} = cellAt(player.x, player.y);
      if(r === endCell.r && c === endCell.c){
        won = true;
        document.getElementById("mazeWin").style.display = "block";
        showToast("Maze üíò", "You made it. Song unlocked.");
        markDone("maze");
        burstHearts();

        // reveal spotify
        revealSpotify();
        document.getElementById("spotifySection").scrollIntoView({behavior:"smooth", block:"start"});
      }

      drawMaze();
    }

    function canvasPosFromEvent(e){
      const rect = canvas.getBoundingClientRect();
      let clientX, clientY;
      if(e.touches && e.touches[0]){
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
      } else {
        clientX = e.clientX;
        clientY = e.clientY;
      }
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      return {
        x: (clientX - rect.left) * scaleX,
        y: (clientY - rect.top) * scaleY
      };
    }

    canvas.addEventListener("touchstart", (e)=>{
      e.preventDefault();
      const p = canvasPosFromEvent(e);
      if(pointInPlayer(p.x,p.y)) dragging = true;
    }, {passive:false});

    canvas.addEventListener("touchmove", (e)=>{
      e.preventDefault();
      if(!dragging) return;
      const p = canvasPosFromEvent(e);
      tryMove(p.x,p.y);
    }, {passive:false});

    canvas.addEventListener("touchend", (e)=>{
      e.preventDefault();
      dragging = false;
    }, {passive:false});

    // mouse (desktop)
    canvas.addEventListener("mousedown", (e)=>{
      const p = canvasPosFromEvent(e);
      if(pointInPlayer(p.x,p.y)) dragging = true;
    });
    canvas.addEventListener("mousemove", (e)=>{
      if(!dragging) return;
      const p = canvasPosFromEvent(e);
      tryMove(p.x,p.y);
    });
    window.addEventListener("mouseup", ()=> dragging=false);

    function resetMaze(){
      won = false;
      dragging = false;
      player = { x: (startCell.c + 0.5)*cellSize, y: (startCell.r + 0.5)*cellSize, r: cellSize*0.22 };
      document.getElementById("mazeWin").style.display = "none";
      // keep spotify visible if already revealed (your call). I‚Äôm leaving it visible once earned.
      drawMaze();
      showToast("Maze reset", "Go again üòâ");
    }

    // ===== init =====
    drawMaze();
    updateProgress();
  </script>
</body>
</html>

